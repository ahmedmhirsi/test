{% extends 'back_office/base.html.twig' %}

{% block title %}System Audit - Nexus AI{% endblock %}

{% block header_title %}
    <span class="flex items-center gap-2">
        <span class="material-symbols-outlined text-red-500 animate-pulse-slow">policy</span>
        Security Audit
    </span>
{% endblock %}

{% block content %}
<div class="swup-transition-fade pb-20">

    {# ─── Terminal Header ─── #}
    <div class="mb-6 flex justify-between items-end">
        <div>
            <h1 class="text-2xl font-black text-white tracking-widest uppercase font-mono mb-1">
                Security_Log<span class="animate-blink">_</span>
            </h1>
            <p class="text-xs font-mono text-gray-500">System Activity Monitor v2.4</p>
        </div>
        <div class="text-right">
            <span class="text-[10px] font-mono text-nexus-primary bg-nexus-primary/10 px-2 py-1 rounded border border-nexus-primary/20">LIVE STREAM</span>
        </div>
    </div>

    {# ─── Terminal Window ─── #}
    <div class="bg-[#0c0e12] rounded-lg border border-white/10 shadow-2xl overflow-hidden font-mono text-sm relative">
        {# Window Controls #}
        <div class="bg-[#1a1d24] px-4 py-2 border-b border-white/5 flex items-center justify-between">
            <div class="flex gap-2">
                <div class="size-3 rounded-full bg-red-500/50"></div>
                <div class="size-3 rounded-full bg-yellow-500/50"></div>
                <div class="size-3 rounded-full bg-green-500/50"></div>
            </div>
            <div class="text-xs text-gray-500">/var/log/audit.log</div>
        </div>

        {# Log Content #}
        <div class="p-0 overflow-x-auto">
            <table class="w-full text-left">
                <thead class="bg-white/5 text-gray-500 text-[10px] uppercase">
                    <tr>
                        <th class="px-6 py-3 font-normal">Timestamp</th>
                        <th class="px-6 py-3 font-normal">Operator</th>
                        <th class="px-6 py-3 font-normal">Operation</th>
                        <th class="px-6 py-3 font-normal">Target</th>
                        <th class="px-6 py-3 font-normal">Payload</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5 text-xs">
                    {% for log in logs %}
                    <tr class="hover:bg-white/5 transition-colors group">
                        {# Date #}
                        <td class="px-6 py-3 text-gray-500 whitespace-nowrap">
                            {{ log.createdAt|date('Y-m-d H:i:s') }}
                        </td>

                        {# User #}
                        <td class="px-6 py-3 text-blue-400 font-bold whitespace-nowrap">
                            <span class="text-gray-600">user:</span>{{ log.details.username ?? 'SYSTEM' }}
                        </td>

                        {# Action #}
                        <td class="px-6 py-3 whitespace-nowrap">
                             {% if 'DELETE' in log.action or 'REMOVE' in log.action %}
                                <span class="text-red-500 font-bold">[DELETE]</span>
                            {% elseif 'CREATE' in log.action or 'ADD' in log.action %}
                                <span class="text-green-500 font-bold">[CREATE]</span>
                            {% elseif 'UPDATE' in log.action or 'EDIT' in log.action %}
                                <span class="text-yellow-500 font-bold">[UPDATE]</span>
                            {% elseif 'LOCK' in log.action %}
                                <span class="text-orange-500 font-bold">[LOCK]</span>
                            {% else %}
                                <span class="text-gray-400">[{{ log.action }}]</span>
                            {% endif %}
                        </td>

                        {# Entity #}
                        <td class="px-6 py-3 text-white whitespace-nowrap">
                            {{ log.entityType }} <span class="text-gray-600">#{{ log.entityId }}</span>
                        </td>

                        {# Details #}
                        <td class="px-6 py-3 text-gray-500 max-w-md truncate group-hover:text-gray-300 transition-colors">
                            {{ log.details|json_encode }}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="px-6 py-12 text-center text-gray-600">
                             -- End of monitoring buffer --
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {# Footer Status #}
        <div class="bg-[#1a1d24] px-4 py-1 border-t border-white/5 flex justify-end">
            <span class="text-[10px] text-green-500 flex items-center gap-1">
                <span class="size-1.5 rounded-full bg-green-500 animate-pulse"></span> SYSTEM SECURE
            </span>
        </div>
    </div>
</div>
{% endblock %}
