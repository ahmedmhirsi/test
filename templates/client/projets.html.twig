{% extends 'front_office/base.html.twig' %}

{% block title %}Mes Projets - SmartNexus AI{% endblock %}

{% block sidebar_nav %}
    {% include 'client/_sidebar.html.twig' %}
{% endblock %}

{% block breadcrumb %}
    <span class="text-[#9ca3af] material-symbols-outlined text-[16px]">chevron_right</span>
    <span class="text-primary font-semibold">Mes Projets</span>
{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="text-3xl font-black text-[#D3C3B9] dark:text-white flex items-center gap-3">
                <span class="material-symbols-outlined text-primary text-[32px]">folder_special</span>
                Mes Projets
            </h1>
            <p class="text-slate-500 dark:text-slate-400 mt-2 font-medium">Suivez l'avancement de vos projets en temps réel.</p>
        </div>
        <div class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-[#1a1d2d] rounded-xl border border-[#e5e7eb] dark:border-[#1f2128] shadow-sm">
            <span class="text-xs font-black text-[#9ca3af] uppercase tracking-wider">{{ projets|length }} Projets Actifs</span>
        </div>
    </div>

    <!-- Project Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for projet in projets %}
            <div class="group bg-white dark:bg-[#1a1d2d] rounded-2xl p-6 border border-[#e5e7eb] dark:border-[#1f2128] shadow-sm hover:shadow-xl hover:border-primary/30 transition-all flex flex-col h-full">
                <!-- Project Status & Icon -->
                <div class="flex justify-between items-start mb-6">
                    <div class="size-14 rounded-2xl bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors">
                        <span class="material-symbols-outlined text-primary text-[32px]">dataset</span>
                    </div>
                    {% set status_class = projet.statut == 'EN_COURS' ? 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400' : 
                                       (projet.statut == 'TERMINE' ? 'bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400' : 'bg-gray-50 text-gray-600 dark:bg-gray-900/20 dark:text-gray-400') %}
                    <span class="px-3 py-1.5 {{ status_class }} rounded-xl text-[10px] font-black uppercase tracking-widest border border-current/20">
                        {{ projet.statut|replace({'_': ' '}) }}
                    </span>
                </div>

                <!-- Project Info -->
                <h3 class="text-xl font-black text-slate-900 dark:text-white mb-3 group-hover:text-primary transition-colors">{{ projet.titre }}</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 line-clamp-3 mb-6 leading-relaxed flex-grow">
                    {{ projet.description }}
                </p>

                <!-- Dates & Milestones -->
                <div class="space-y-4 pt-6 border-t border-[#e5e7eb] dark:border-[#1f2128]">
                    <div class="flex items-center justify-between text-xs">
                        <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400">
                            <span class="material-symbols-outlined text-[16px] text-primary">event</span>
                            <span>Début : {{ projet.dateDebut|date('d/m/Y') }}</span>
                        </div>
                        <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400">
                            <span class="material-symbols-outlined text-[16px] text-primary">flag_circle</span>
                            <span>{{ projet.sprints|length }} Sprints</span>
                        </div>
                    </div>

                    <!-- Progress Bar (Simplified Placeholder if no numeric progress in entity) -->
                    <div class="space-y-2">
                        <div class="flex justify-between text-[10px] font-black uppercase tracking-tighter">
                            <span class="text-slate-400">Progression Globale</span>
                            <span class="text-primary">{{ projet.statut == 'TERMINE' ? '100' : '45' }}%</span>
                        </div>
                        <div class="h-2 w-full bg-slate-100 dark:bg-[#161516] rounded-full overflow-hidden">
                            <div class="h-full bg-primary transition-all duration-1000 shadow-[0_0_10px_rgba(255,193,5,0.4)]" style="width: {{ projet.statut == 'TERMINE' ? '100' : '45' }}%"></div>
                        </div>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="mt-6 flex gap-2">
                    <a href="{{ path('app_client_jalons', {'projet': projet.id}) }}" class="flex-1 flex items-center justify-center py-3 bg-navy dark:bg-[#161516] text-white dark:text-white rounded-xl text-xs font-black hover:opacity-90 transition-all border border-transparent hover:border-primary/30">
                        Consulter Jalons
                    </a>
                </div>
            </div>
        {% else %}
            <div class="col-span-full py-20 bg-white dark:bg-[#1a1d2d] rounded-3xl border border-dashed border-[#e5e7eb] dark:border-[#1f2128] flex flex-col items-center justify-center text-center">
                <div class="size-20 rounded-full bg-slate-50 dark:bg-[#161516] flex items-center justify-center mb-4">
                    <span class="material-symbols-outlined text-slate-300 text-[40px]">folder_off</span>
                </div>
                <h3 class="text-xl font-black text-slate-900 dark:text-white">Aucun projet trouvé</h3>
                <p class="text-slate-500 dark:text-slate-400 mt-2 max-w-sm mx-auto">Vous n'avez pas encore de projet en cours dans votre dashboard client.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
