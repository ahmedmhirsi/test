{% extends 'front_office/base.html.twig' %}

{% block title %}Réclamation : {{ reclamation.titre }} - SmartNexus AI{% endblock %}

{% block sidebar_nav %}
    <a href="{{ path('app_client_dashboard') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold text-[#5e658d] dark:text-[#9ca3af] hover:bg-gray-100 dark:hover:bg-[#252836] transition-colors">
        <span class="material-symbols-outlined text-[20px]">dashboard</span>
        <span>Tableau de bord</span>
    </a>
    <a href="{{ path('app_client_explore') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold text-[#5e658d] dark:text-[#9ca3af] hover:bg-gray-100 dark:hover:bg-[#252836] transition-colors">
        <span class="material-symbols-outlined text-[20px]">explore</span>
        <span>Explorer</span>
    </a>
    <a href="{{ path('app_client_offers') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold text-[#5e658d] dark:text-[#9ca3af] hover:bg-gray-100 dark:hover:bg-[#252836] transition-colors">
        <span class="material-symbols-outlined text-[20px]">work</span>
        <span>Mes Offres</span>
    </a>
    <a href="{{ path('app_client_applications') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold text-[#5e658d] dark:text-[#9ca3af] hover:bg-gray-100 dark:hover:bg-[#252836] transition-colors">
        <span class="material-symbols-outlined text-[20px]">group</span>
        <span>Candidatures</span>
    </a>
    <a href="{{ path('front_reclamation_index') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold bg-primary/10 text-primary transition-colors">
        <span class="material-symbols-outlined text-[20px]">list_alt</span>
        <span>Réclamations</span>
    </a>
    <a href="{{ path('app_profile') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-bold text-[#5e658d] dark:text-[#9ca3af] hover:bg-gray-100 dark:hover:bg-[#252836] transition-colors">
        <span class="material-symbols-outlined text-[20px]">person</span>
        <span>Mon Profil</span>
    </a>
{% endblock %}

{% block breadcrumb %}
    <span class="text-[#9ca3af] material-symbols-outlined text-[16px]">chevron_right</span>
    <a href="{{ path('front_reclamation_index') }}" class="text-[#9ca3af] hover:text-primary">Réclamations</a>
    <span class="text-[#9ca3af] material-symbols-outlined text-[16px]">chevron_right</span>
    <span class="text-primary font-semibold">Détails</span>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">
        <!-- Main Message -->
        <div class="bg-white dark:bg-[#1a1d2d] rounded-2xl border border-[#e5e7eb] dark:border-[#2d3142] shadow-sm overflow-hidden">
            <div class="p-6 border-b border-[#f0f0f5] dark:border-[#2d3142] flex justify-between items-center bg-gray-50/50 dark:bg-[#252836]/30">
                <h1 class="text-xl font-black dark:text-white">{{ reclamation.titre }}</h1>
                <div class="flex gap-2">
                    <a href="{{ path('front_reclamation_edit', {id: reclamation.id}) }}" class="size-9 flex items-center justify-center bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg text-[#5e658d] hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-base">edit</span>
                    </a>
                    <form method="post" action="{{ path('front_reclamation_delete', {id: reclamation.id}) }}" onsubmit="return confirm('Supprimer ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ reclamation.id) }}">
                        <button class="size-9 flex items-center justify-center bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg text-[#5e658d] hover:text-red-500 transition-colors">
                            <span class="material-symbols-outlined text-base">delete</span>
                        </button>
                    </form>
                </div>
            </div>
            <div class="p-8">
                <p class="text-slate-900 dark:text-white leading-relaxed whitespace-pre-wrap">{{ reclamation.description }}</p>
                {% if reclamation.pieceJointe %}
                    <div class="mt-6 flex items-center gap-3 p-4 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700">
                        <span class="material-symbols-outlined text-primary">attach_file</span>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-bold text-slate-900 dark:text-white truncate">Pièce jointe</p>
                            <a href="{{ asset('uploads/reclamations/' ~ reclamation.pieceJointe) }}" target="_blank" class="text-[10px] text-primary hover:underline font-black uppercase">Télécharger le fichier</a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Conversation / Responses -->
        <div class="space-y-4">
            <h2 class="text-lg font-black dark:text-white px-2">Conversation</h2>
            {% for reponse in reclamation.reponses %}
                <div class="flex gap-4 {{ reponse.auteurType == 'client' ? 'flex-row-reverse' : '' }}">
                    <div class="size-10 rounded-full flex items-center justify-center shrink-0 shadow-sm
                        {{ reponse.auteurType == 'client' ? 'bg-primary text-navy' : 'bg-navy text-white' }}">
                        <span class="material-symbols-outlined text-[20px]">{{ reponse.auteurType == 'client' ? 'person' : 'support_agent' }}</span>
                    </div>
                    <div class="max-w-[80%] {{ reponse.auteurType == 'client' ? 'text-right' : '' }}">
                        <div class="mb-1 flex items-baseline gap-2 {{ reponse.auteurType == 'client' ? 'flex-row-reverse' : '' }}">
                            <span class="text-xs font-black dark:text-white capitalize">{{ reponse.auteur }}</span>
                            <span class="text-[9px] text-slate-400 font-bold">{{ reponse.dateReponse|date('H:i, d M') }}</span>
                        </div>
                        <div class="p-4 rounded-2xl shadow-sm text-sm border
                            {{ reponse.auteurType == 'client' ? 'bg-primary/5 border-primary/20 text-slate-900 dark:text-white rounded-tr-none' : 'bg-white dark:bg-[#1a1d2d] border-[#e5e7eb] dark:border-[#2d3142] text-slate-900 dark:text-white rounded-tl-none' }}">
                            {{ reponse.message }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Add Response Form -->
        <div class="bg-white dark:bg-[#1a1d2d] rounded-2xl p-6 border border-[#e5e7eb] dark:border-[#2d3142] shadow-sm">
            <h3 class="text-sm font-black dark:text-white mb-4 uppercase tracking-widest">Ajouter une réponse</h3>
            {{ form_start(reponse_form, {'attr': {'novalidate': 'novalidate'}}) }}
                {{ form_widget(reponse_form.message, {'attr': {'class': 'w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-sm focus:ring-2 focus:ring-primary/20 outline-none mb-4 min-h-[100px]', 'placeholder': 'Écrivez votre message ici...'}}) }}
                <div class="flex justify-between items-center">
                    <div class="flex-1 mr-4">
                        {{ form_widget(reponse_form.pieceJointe, {'attr': {'class': 'text-[10px]'}}) }}
                    </div>
                    <button class="h-10 px-6 bg-primary hover:bg-primary/90 text-navy rounded-lg font-bold text-xs shadow-lg shadow-primary/20 transition-all">
                        Envoyer
                    </button>
                </div>
            {{ form_end(reponse_form) }}
        </div>
    </div>

    <!-- Sidebar Info -->
    <div class="space-y-6">
        <div class="bg-white dark:bg-[#1a1d2d] rounded-2xl border border-[#e5e7eb] dark:border-[#2d3142] shadow-sm p-6">
            <h3 class="text-sm font-black dark:text-white mb-4 uppercase tracking-widest">Informations</h3>
            <div class="space-y-4">
                <div>
                    <p class="text-[10px] font-black uppercase text-slate-400 mb-1">Statut</p>
                    {% if reclamation.statut == 'en_cours' %}
                        <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-[10px] font-black uppercase">En cours</span>
                    {% elseif reclamation.statut == 'repondu' %}
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-[10px] font-black uppercase">Répondu</span>
                    {% else %}
                        <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-[10px] font-black uppercase">Fermée</span>
                    {% endif %}
                </div>
                <div>
                    <p class="text-[10px] font-black uppercase text-slate-400 mb-1">Date</p>
                    <p class="text-sm font-bold dark:text-white">{{ reclamation.dateCreation|date('d F Y') }}</p>
                </div>
                <div>
                    <p class="text-[10px] font-black uppercase text-slate-400 mb-1">Email</p>
                    <p class="text-sm font-bold dark:text-white break-all">{{ reclamation.email }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
