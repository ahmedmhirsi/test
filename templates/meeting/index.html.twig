{% extends 'layout/employe.html.twig' %}

{% block title %}Meetings - Nexus AI{% endblock %}

{% block breadcrumb %}
    <span class="text-gray-500 material-symbols-outlined text-[16px]">chevron_right</span>
    <span class="text-nexus-primary font-semibold">Collaboration</span>
    <span class="text-gray-500 material-symbols-outlined text-[16px]">chevron_right</span>
    <span class="text-gray-400">Meetings</span>
{% endblock %}

{% block content %}
<div class="swup-transition-fade space-y-6">
    <!-- Header Section -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h1 class="text-3xl font-black tracking-tight text-white mb-1 text-glow">Meetings</h1>
            <p class="text-gray-400 text-sm font-medium">Planifiez et gérez vos réunions d'équipe</p>
        </div>
        <div class="flex items-center gap-3">
             <a href="{{ path('app_meeting_export_pdf') }}" class="btn-nexus-secondary group" title="Export PDF">
                <span class="material-symbols-outlined text-red-400 group-hover:text-red-300">picture_as_pdf</span>
            </a>
            <a href="{{ path('app_meeting_new') }}" class="btn-nexus-primary shadow-lg shadow-indigo-500/20 group">
                <span class="material-symbols-outlined mr-2 group-hover:rotate-90 transition-transform">add</span>
                Nouveau Meeting
            </a>
        </div>
    </div>

    <!-- Filters & Search -->
    <div class="nexus-card p-4 flex flex-col lg:flex-row gap-4 animate-card">
        <form method="get" action="{{ path('app_meeting_index') }}" class="flex-1 relative">
            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">search</span>
            <input type="text" name="q" value="{{ searchTerm }}" placeholder="Rechercher par titre..."
                   class="w-full pl-12 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-sm focus:ring-2 focus:ring-nexus-primary focus:border-nexus-primary outline-none transition-all text-white placeholder-gray-500">
            <input type="hidden" name="sort" value="{{ currentSort }}">
            <input type="hidden" name="order" value="{{ currentOrder }}">
        </form>

        <div class="flex items-center gap-2 overflow-x-auto pb-2 lg:pb-0">
            <span class="text-gray-500 text-xs font-bold uppercase tracking-wider whitespace-nowrap mr-2">Trier par :</span>
            <div class="flex gap-2">
                {% set sort_fields = {
                    'titre': 'Titre',
                    'date_debut': 'Date',
                    'statut': 'Statut'
                } %}
                {% for field, label in sort_fields %}
                    <a href="{{ path('app_meeting_index', {q: searchTerm, sort: field, order: currentSort == field and currentOrder == 'ASC' ? 'DESC' : 'ASC'}) }}" 
                       class="px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap border {{ currentSort == field ? 'bg-nexus-primary text-white border-nexus-primary shadow-lg shadow-nexus-primary/20' : 'bg-white/5 text-gray-400 border-white/5 hover:bg-white/10 hover:text-white' }}">
                        {{ label }}
                        {% if currentSort == field %}
                            <span class="material-symbols-outlined text-[14px] align-middle ml-1">{{ currentOrder == 'ASC' ? 'expand_less' : 'expand_more' }}</span>
                        {% endif %}
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Grid Layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for meeting in meetings %}
            <div class="nexus-card group p-0 relative overflow-hidden flex flex-col animate-card" style="animation-delay: {{ loop.index * 0.1 }}s">
                
                <div class="p-6 flex-1">
                    <div class="flex justify-between items-start mb-4">
                        <div class="size-10 rounded-xl bg-gradient-to-br from-nexus-primary to-violet-600 flex items-center justify-center shadow-lg shadow-nexus-primary/20 text-white">
                            <span class="material-symbols-outlined">event</span>
                        </div>
                        <span class="px-2.5 py-1 text-[10px] font-black uppercase tracking-widest rounded-lg border 
                            {% if meeting.statut == 'En cours' %}bg-emerald-500/10 text-emerald-400 border-emerald-500/20
                            {% elseif meeting.statut == 'Planifié' %}bg-blue-500/10 text-blue-400 border-blue-500/20
                            {% else %}bg-gray-500/10 text-gray-400 border-gray-500/20{% endif %}">
                            <span class="size-1.5 rounded-full inline-block mr-1 
                                {% if meeting.statut == 'En cours' %}bg-emerald-400 animate-pulse
                                {% elseif meeting.statut == 'Planifié' %}bg-blue-400
                                {% else %}bg-gray-400{% endif %}"></span>
                            {{ meeting.statut }}
                        </span>
                    </div>
                    
                    <h3 class="text-xl font-bold text-white mb-4 line-clamp-1 group-hover:text-nexus-primary transition-colors">
                        <a href="{{ path('app_meeting_show', {'id': meeting.id}) }}">{{ meeting.titre }}</a>
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center gap-3 text-sm text-gray-400">
                            <span class="material-symbols-outlined text-nexus-primary text-[18px]">calendar_today</span>
                            <span class="font-medium">{{ meeting.dateDebut|date('d/m/Y') }} à {{ meeting.dateDebut|date('H:i') }}</span>
                        </div>
                        <div class="flex items-center gap-3 text-sm text-gray-400">
                            <span class="material-symbols-outlined text-nexus-primary text-[18px]">timer</span>
                            <span class="font-medium">{{ meeting.duree }} minutes</span>
                        </div>
                        <div class="flex items-center gap-3 text-sm text-gray-400">
                            <span class="material-symbols-outlined text-nexus-primary text-[18px]">group</span>
                            <span class="font-medium">{{ meeting.participantCount }} participants</span>
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-white/5 border-t border-white/5 flex gap-2">
                    <a href="{{ path('app_meeting_show', {'id': meeting.id}) }}" class="flex-1 h-9 flex items-center justify-center gap-2 bg-nexus-navy border border-white/10 text-white text-xs font-bold uppercase tracking-wider rounded-lg hover:bg-nexus-primary hover:border-nexus-primary transition-all">
                        <span class="material-symbols-outlined text-[16px]">visibility</span>
                        Voir
                    </a>
                    <a href="{{ path('app_meeting_edit', {'id': meeting.id}) }}" class="size-9 flex items-center justify-center border border-white/10 text-gray-400 rounded-lg hover:bg-nexus-accent hover:border-nexus-accent hover:text-white transition-all">
                        <span class="material-symbols-outlined text-[18px]">edit</span>
                    </a>
                </div>
            </div>
        {% else %}
            <div class="col-span-full py-20 text-center">
                <div class="size-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="material-symbols-outlined text-gray-600 text-4xl">event_busy</span>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Aucun meeting trouvé</h3>
                <p class="text-gray-500 mb-6">Commencez par créer une nouvelle réunion pour votre équipe.</p>
                <a href="{{ path('app_meeting_new') }}" class="btn-nexus-primary">
                    <span class="material-symbols-outlined mr-2">add</span>
                    Créer le premier meeting
                </a>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
