{% extends 'layout/admin.html.twig' %}
{% import '_components.html.twig' as ui %}

{% block title %}Search: {{ query }} – SmartNexus AI{% endblock %}

{% block body %}
    {# ========== Page Header ========== #}
    <div class="mb-8">
        <h1 class="text-navy dark:text-white text-3xl font-black mb-2">Search Results</h1>
        {% if query %}
            <p class="text-gray-500">
                <span class="font-medium text-navy dark:text-white">{{ totalResults }}</span> 
                result{{ totalResults != 1 ? 's' : '' }} for 
                "<span class="text-primary font-medium">{{ query }}</span>"
            </p>
        {% else %}
            <p class="text-gray-500">Enter a search term to find projects, sprints, and tasks</p>
        {% endif %}
    </div>

    {# ========== Search Form ========== #}
    <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-6 mb-8">
        <form action="{{ path('app_search') }}" method="GET" class="flex gap-4">
            <div class="flex-1">
                <div class="flex w-full items-stretch rounded-xl h-12 bg-gray-100 dark:bg-gray-800">
                    <div class="text-gray-500 flex items-center justify-center pl-4">
                        <span class="material-symbols-outlined">search</span>
                    </div>
                    <input type="text" name="q" value="{{ query }}"
                           class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-navy dark:text-white focus:outline-0 focus:ring-0 border-none bg-transparent h-full placeholder:text-gray-400 px-4 pl-2 text-base font-normal"
                           placeholder="Search projects, sprints, tasks..." autofocus />
                </div>
            </div>
            <button type="submit" 
                    class="px-6 py-3 bg-primary hover:bg-yellow-500 text-navy font-bold rounded-lg transition-all shadow-lg shadow-primary/20">
                Search
            </button>
        </form>
    </div>

    {% if query and totalResults == 0 %}
        {# ========== No Results ========== #}
        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-16 text-center">
            <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">search_off</span>
            <h3 class="text-navy dark:text-white text-xl font-bold mb-2">No results found</h3>
            <p class="text-gray-500">Try a different search term or browse the sections below</p>
            <div class="flex justify-center gap-4 mt-6">
                <a href="{{ path('app_projet_index') }}" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-navy dark:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    View Projects
                </a>
                <a href="{{ path('app_sprint_index') }}" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-navy dark:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    View Sprints
                </a>
                <a href="{{ path('app_tache_index') }}" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-navy dark:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    View Tasks
                </a>
            </div>
        </div>
    {% endif %}

    {% if results.projets|length > 0 %}
        {# ========== Projects Results ========== #}
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <span class="material-symbols-outlined text-primary">folder_open</span>
                <h2 class="text-navy dark:text-white text-xl font-bold">Projects ({{ results.projets|length }})</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for projet in results.projets %}
                    <a href="{{ path('app_projet_show', {id: projet.id}) }}" 
                       class="group bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-5 hover:border-primary hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-navy dark:text-white font-bold group-hover:text-primary transition-colors">{{ projet.titre }}</h3>
                            {{ ui.status_badge(projet.statut) }}
                        </div>
                        {% if projet.description %}
                            <p class="text-gray-500 text-sm line-clamp-2">{{ projet.description|slice(0, 80) }}{{ projet.description|length > 80 ? '...' : '' }}</p>
                        {% endif %}
                    </a>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {% if results.sprints|length > 0 %}
        {# ========== Sprints Results ========== #}
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <span class="material-symbols-outlined text-primary">history</span>
                <h2 class="text-navy dark:text-white text-xl font-bold">Sprints ({{ results.sprints|length }})</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for sprint in results.sprints %}
                    <a href="{{ path('app_sprint_show', {id: sprint.id}) }}" 
                       class="group bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-5 hover:border-primary hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-navy dark:text-white font-bold group-hover:text-primary transition-colors">{{ sprint.nom }}</h3>
                            {{ ui.status_badge(sprint.statut) }}
                        </div>
                        {% if sprint.projet %}
                            <p class="text-gray-400 text-xs mb-2">{{ sprint.projet.titre }}</p>
                        {% endif %}
                        <div class="flex items-center gap-2 text-gray-500 text-sm">
                            <span class="material-symbols-outlined text-base">calendar_today</span>
                            <span>{{ sprint.dateDebut|date('M d') }} - {{ sprint.dateFin|date('M d, Y') }}</span>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {% if results.taches|length > 0 %}
        {# ========== Tasks Results ========== #}
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <span class="material-symbols-outlined text-primary">task_alt</span>
                <h2 class="text-navy dark:text-white text-xl font-bold">Tasks ({{ results.taches|length }})</h2>
            </div>
            <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden">
                <div class="divide-y divide-gray-100 dark:divide-gray-800">
                    {% for tache in results.taches %}
                        <a href="{{ path('app_tache_show', {id: tache.id}) }}" 
                           class="flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <div class="flex items-center gap-4">
                                <div class="p-2 bg-gray-100 dark:bg-gray-800 rounded-lg">
                                    <span class="material-symbols-outlined text-gray-500">task_alt</span>
                                </div>
                                <div>
                                    <p class="text-navy dark:text-white font-medium">{{ tache.titre }}</p>
                                    <p class="text-gray-400 text-xs">
                                        SN-{{ tache.id }}
                                        {% if tache.sprint %} · {{ tache.sprint.nom }}{% endif %}
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                {{ ui.priority_badge(tache.priorite) }}
                                {{ ui.status_badge(tache.statut) }}
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
